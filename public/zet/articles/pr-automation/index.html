<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=52261&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PR Automation | Radek Padrta</title>
<meta name=keywords content="Azure,DevOps"><meta name=description content="We have a couple of codes in one repository, each creates a web application. We need to create the web app with an environment that will be short-lived, allowing someone to test the app within short time period.
We want to automate the process, and one way to do that is to build the solution through a Pull Request.
Why through Pull Request? Imagine you created an application or just some feature in your app."><meta name=author content="Radek Padrta"><link rel=canonical href=http://localhost:52261/zet/articles/pr-automation/><link crossorigin=anonymous href=/assets/css/stylesheet.min.4488ce9bd833dbcf6321ed2b85cf8e9fbd861565c78f1eac6b277109b364480b.css integrity="sha256-RIjOm9gz289jIe0rhc+On72GFWXHjx6saydxCbNkSAs=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:52261/favicon.ico><link rel=apple-touch-icon href=http://localhost:52261/apple-touch-icon.png><link rel=alternate hreflang=en href=http://localhost:52261/zet/articles/pr-automation/><script async src="https://www.googletagmanager.com/gtag/js?id=G-BGXYV0CH1C"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BGXYV0CH1C")}</script><meta name=twitter:card content="summary"><meta name=twitter:title content="PR Automation | Radek Padrta"><meta name=twitter:description content="We have a couple of codes in one repository, each creates a web application. We need to create the web app with an environment that will be short-lived, allowing someone to test the app within short time period.
We want to automate the process, and one way to do that is to build the solution through a Pull Request.
Why through Pull Request? Imagine you created an application or just some feature in your app."><meta property="og:title" content="PR Automation | Radek Padrta"><meta property="og:description" content="We have a couple of codes in one repository, each creates a web application. We need to create the web app with an environment that will be short-lived, allowing someone to test the app within short time period.
We want to automate the process, and one way to do that is to build the solution through a Pull Request.
Why through Pull Request? Imagine you created an application or just some feature in your app."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:52261/zet/articles/pr-automation/"><meta property="og:image" content="https://radekapadrta.cz/cloud-blue-logo.jpeg"><meta property="article:section" content="zet"><meta property="article:published_time" content="2024-08-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-19T00:00:00+00:00"><meta property="og:site_name" content="Radek Padrta - Blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Zettelkasten","item":"http://localhost:52261/zet/"},{"@type":"ListItem","position":2,"name":"PR Automation","item":"http://localhost:52261/zet/articles/pr-automation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PR Automation | Radek Padrta","name":"PR Automation","description":"We have a couple of codes in one repository, each creates a web application. We need to create the web app with an environment that will be short-lived, allowing someone to test the app within short time period.\nWe want to automate the process, and one way to do that is to build the solution through a Pull Request.\nWhy through Pull Request? Imagine you created an application or just some feature in your app.","keywords":["Azure","DevOps"],"wordCount":"1001","inLanguage":"en","datePublished":"2024-08-19T00:00:00Z","dateModified":"2024-08-19T00:00:00Z","author":[{"@type":"Person","name":"Radek Padrta"}],"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:52261/zet/articles/pr-automation/"},"publisher":{"@type":"Organization","name":"Radek Padrta","logo":{"@type":"ImageObject","url":"http://localhost:52261/favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-zet kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:52261/ accesskey=h title="Radek Padrta (Alt + H)"><img src=http://localhost:52261/cloudhammer.svg alt=logo aria-label=logo height=30 width=30>Radek Padrta</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://localhost:52261/aboutme/ title=About>About</a></li><li><a href=http://localhost:52261/tags/ title=Tags>Tags</a></li><li><a href=http://localhost:52261/archives/ title=Index>Index</a></li><li><a href=http://localhost:52261/search/ title="üîç (Alt + /)" data-no-instant accesskey=/>üîç</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>PR Automation</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>August 19, 2024</span></span><span class=meta-item>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=http://localhost:52261/tags/azure/>Azure</a><a href=http://localhost:52261/tags/devops/>DevOps</a></span></span></div></header><div class=post-content><p>We have a couple of codes in one repository, each creates a web application. We need to create the web app with an environment that will be short-lived, allowing someone to test the app within short time period.</p><p>We want to automate the process, and one way to do that is to build the solution through a Pull Request.</p><h2 id=why-through-pull-request>Why through Pull Request?<a hidden class=anchor aria-hidden=true href=#why-through-pull-request>¬∂</a></h2><p>Imagine you created an application or just some feature in your app. You don‚Äôt want to push it to the production environment, but rather to a short-lived environment, to ensure that everything is okay and to decide if you can merge the PR request, for example, to the main branch. The short-lived environment provides us with a space to test the application.</p><h2 id=how-it-works>How it works?<a hidden class=anchor aria-hidden=true href=#how-it-works>¬∂</a></h2><p>A user on GitHub will open a Pull Request. They will then choose which application they want to build (remember, we have multiple applications/features in one repository). The user selects the option they want to build, for example, Variant2.</p><h4 id=how-can-the-user-choose-which-app>How can the user choose which app?<a hidden class=anchor aria-hidden=true href=#how-can-the-user-choose-which-app>¬∂</a></h4><p>In the PR, there are labels. We have created a label named Variant2. If the user selects this label and opens the PR, it will trigger the pipeline, and many things will be triggered. We will discuss this in more detail later, but first, let‚Äôs talk about our possibilities.</p><h3 id=what-are-our-options>What are our options?<a hidden class=anchor aria-hidden=true href=#what-are-our-options>¬∂</a></h3><p>There are three types I&rsquo;m working on. There may be more options, and I would be really glad to hear your thoughts about it.</p><p>Our case: We have code in GitHub.
My testing includes the following:</p><ul><li>Web App - Azure DevOps</li><li>Static Web App - Azure DevOps</li><li>Static Web App - GitHub Actions</li></ul><p>Let&rsquo;s discuss each, how it works at a high level, and the pros and cons.</p><h2 id=web-app---azure-devops>Web App - Azure DevOps<a hidden class=anchor aria-hidden=true href=#web-app---azure-devops>¬∂</a></h2><p>We opened the PR. We didn&rsquo;t select a label. Should the pipeline be triggered? No.
Why is it not triggered? Because we are using a webhook, and we defined what will trigger it. In our case, it is when a label is added.</p><p><img loading=lazy src=/PRAUT_WebhookTrigger.png type alt></p><p>You might be wondering, what if we select a different label?
For this, we have a pipeline with many conditions that check what is needed and what is already set.</p><p>Here is a visualization of the flow.
<img loading=lazy src=/PRAUT_WA.png type alt></p><p>I will not dive into the solution, or I would be writing about it for hours. The solution is in <a href=https://github.com/radekpadrta/PRAutomation/blob/main/azure-pipelines-pr-open.yml>azure-pipelines-pr-open.yml</a>. You can check it there and you will find other pipeline there.</p><h5 id=what-is-cool-about-this-solution>What is cool about this solution?<a hidden class=anchor aria-hidden=true href=#what-is-cool-about-this-solution>¬∂</a></h5><p>You can manage everything and have full control over your build. You can trigger comments for your developers, letting them know what is happening in the pipeline while they wait for the short-lived environment. It‚Äôs a flexible solution and, in my opinion, this approach is best for larger applications because it allows you to simulate everything needed in Azure. We are not just creating the Web App, we are also creating the container image, setting policies, and managing RBAC for each Web App. No need to use any tokens&mldr;everything is done through CLI and managed identity.</p><h5 id=what-is-bad>What is bad?<a hidden class=anchor aria-hidden=true href=#what-is-bad>¬∂</a></h5><p>You need to pay for the service plan, create additional components, and the pipeline can become larger and harder to maintain with changes. You also need to implement lifecycle management. If you want to use a web app, you need to create a container for your code and wait for boot-up until your app is ready. Typically, this takes about 6-9 minutes, even when using very basic code.</p><h2 id=static-web-app---azure-devops>Static Web App - Azure DevOps<a hidden class=anchor aria-hidden=true href=#static-web-app---azure-devops>¬∂</a></h2><p>The trigger is the same as above. We are using a Static Web App, which means we don‚Äôt need as much in the pipeline as for a Web App. All we need is the Static Web App.</p><p><img loading=lazy src=/PRAUT_SWA.png type alt></p><h5 id=what-is-cool>What is cool?<a hidden class=anchor aria-hidden=true href=#what-is-cool>¬∂</a></h5><p>You can create preview environments and configure them as needed. For example, you can create two or three apps in one PR by selecting two or three labels, and it is cheaper than using a Web App.</p><h5 id=what-is-bad-1>What is bad?<a hidden class=anchor aria-hidden=true href=#what-is-bad-1>¬∂</a></h5><p>It is similarly challenging to set up as a Web App and hard to maintain if there are changes.</p><h2 id=static-web-app---github-actions>Static Web App - GitHub Actions<a hidden class=anchor aria-hidden=true href=#static-web-app---github-actions>¬∂</a></h2><p>You need to set up the connection between the Static Web App and GitHub. You can follow this guide to do that: <a href=https://github.com/radekpadrta/PRAutomation/tree/testPR>How to conenct SWA with GitHub</a></p><p>Once you set the connection, a pipeline for GitHub Actions will be automatically created in your repository.</p><p>This automatically created pipeline is not ideal for our use case, but if we make it prettier, it can be very useful!</p><p>The udpated pipeline can be found <a href=https://github.com/radekpadrta/PRAutomation/blob/main/.github/workflows/azure-static-web-apps-black-hill-01e38be0f.yml>here</a></p><p>We don‚Äôt need to worry about webhooks or payloads, and we don‚Äôt use any conditions. Everything is handled in a different way, which we don&rsquo;t see.</p><p>The only things we need to configure is how to get the URL of the preview environment and how to choose which app we want to build.</p><h5 id=what-is-cool-1>What is cool?<a hidden class=anchor aria-hidden=true href=#what-is-cool-1>¬∂</a></h5><p>If the code is in GitHub, it‚Äôs easy to set up Actions, understand, and maintain. One PR = One App. I working now on how to make it more flexible, so hopefully, in the next post, there will be some progress. But overall, it&rsquo;s best solution.</p><h5 id=what-is-bad-2>What is bad?<a hidden class=anchor aria-hidden=true href=#what-is-bad-2>¬∂</a></h5><p>We don‚Äôt work with the payload, making it difficult to create flexible tasks. Additionally, we don‚Äôt see what is happening in GitHub Actions, for example when it sends information to users.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>¬∂</a></h2><p>If you have a lot of time, want to be sure everything is set up according to your needs, and you have money, go for the Web App.</p><p>If you have some time, and already Azure set for your Web App environments, and want to test the solution and discard it without incurring high costs, choose the Static Web App.</p><p>If you want an easy solution, don‚Äôt want to spend much time on it, and don‚Äôt need a highly flexible setup, go with the Static Web App using GitHub Actions.</p><h4 id=links>LINKS:<a hidden class=anchor aria-hidden=true href=#links>¬∂</a></h4><p>16-08-2024-08:49</p><hr><p>[[]]</p></div><footer class=post-footer><nav class=paginav><a class=prev href=http://localhost:52261/zet/articles/reflection-on-madeira/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Reflection on Madeira</span>
</a><a class=next href=http://localhost:52261/zet/articles/create-business/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Building a home business üè°</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:52261/>Radek Padrta</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:1em><a href=https://www.linkedin.com/in/radekpadrta/ rel=noopener target=_blank>Linkedin</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a=""=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>